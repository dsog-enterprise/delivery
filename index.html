<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.7, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#25D366">
    <title>DSOG DELIVERY | WhatsApp Pickup Platform</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Sign-in SDK -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        :root {
            --primary-green: #25D366;
            --primary-black: #000000;
            --primary-gold: #D4AF37;
            --secondary-green: #128C7E;
            --bg-secondary: #f8f8f8;
            --white: #FFFFFF;
            --text-primary: #222222;
            --text-secondary: #5a5a5a;
            --border-color: #e0e0e0;
            --error: #FF4444;
            --warning: #FFA500;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* Header */
        header {
            background: var(--primary-black);
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0,0,0,0.2);
            border-bottom: 3px solid var(--primary-green);
            display: none;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            height: 35px;
            filter: drop-shadow(0 2px 4px rgba(37, 211, 102, 0.3));
        }
        
        /* Preloader */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-black) 0%, #0d0d0d 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .preloader.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        /* Step Progress */
        .step-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem auto;
            max-width: 1200px;
            padding: 0 1.5rem;
            position: relative;
        }
        
        .step-progress-bar {
            position: absolute;
            top: 50%;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-green), var(--primary-gold));
            z-index: 2;
            transform: translateY(-50%);
            transition: var(--transition);
            width: 0%;
        }
        
        .step {
            position: relative;
            z-index: 3;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--white);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .step.active .step-circle {
            background: var(--primary-green);
            border-color: var(--primary-green);
            color: var(--white);
        }
        
        .step.completed .step-circle {
            background: var(--primary-green);
            border-color: var(--primary-green);
            color: var(--white);
        }
        
        .step.completed .step-circle::after {
            content: '‚úì';
            font-weight: bold;
        }
        
        .step-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-align: center;
            transition: var(--transition);
        }
        
        .step.active .step-label {
            color: var(--primary-green);
        }
        
        /* Step Content */
        .step-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: none;
            animation: fadeIn 0.5s ease;
            min-height: 70vh;
            padding-bottom: 120px !important;
        }
        
        .step-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Step Navigation */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding: 1.5rem 0;
            border-top: 1px solid var(--border-color);
            position: fixed;
            bottom: 80px;
            left: 0;
            right: 0;
            background: var(--white);
            z-index: 100;
            max-width: 1200px;
            margin: 0 auto;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        
        .step-btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            min-width: 140px;
            justify-content: center;
        }
        
        .step-btn.prev {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .step-btn.prev:hover {
            background: var(--border-color);
        }
        
        .step-btn.next {
            background: var(--primary-green);
            color: var(--white);
        }
        
        .step-btn.next:hover {
            background: var(--secondary-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.1);
        }
        
        .step-btn.confirm {
            background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
            color: var(--white);
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
        }
        
        /* Cards */
        .card {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.15);
            margin: 1.5rem 0;
            border: 3px solid var(--primary-green);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .card-header i {
            color: var(--primary-green);
            font-size: 2rem;
        }
        
        .card-header h3 {
            margin: 0;
            color: var(--primary-black);
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--bg-secondary);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-green);
            background: var(--white);
            box-shadow: 0 0 0 4px rgba(37, 211, 102, 0.1);
        }
        
        /* Package Selection */
        .package-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .package-card {
            background: var(--bg-secondary);
            border: 3px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        
        .package-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-green);
        }
        
        .package-card.selected {
            background: linear-gradient(135deg, rgba(37, 211, 102, 0.1), rgba(212, 175, 55, 0.05));
            border-color: var(--primary-green);
            color: var(--primary-green);
        }
        
        /* Assistant Grid */
        .assistants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .assistant-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: var(--transition);
            border: 2px solid var(--border-color);
            cursor: pointer;
        }
        
        .assistant-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.15);
            border-color: var(--primary-green);
        }
        
        .assistant-card.selected {
            background: linear-gradient(135deg, rgba(37, 211, 102, 0.1), rgba(37, 211, 102, 0.05));
            border-color: var(--primary-green);
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            display: none;
        }
        
        .loading.visible {
            display: block;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(37, 211, 102, 0.1);
            border-top: 3px solid var(--primary-green);
            border-right: 3px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--primary-green);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 30px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
            font-weight: 600;
            display: none;
        }
        
        .notification.show {
            display: block;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Google Sign-in Modal */
        .google-signin-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.98);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2005;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 2rem;
            display: none;
        }
        
        .google-signin-modal.active {
            opacity: 1;
            visibility: visible;
            display: flex;
        }
        
        .google-signin-content {
            background: var(--white);
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            padding: 3rem;
            position: relative;
            animation: modalSlideIn 0.4s ease;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .step-progress {
                padding: 0 1rem;
            }
            
            .step-circle {
                width: 35px;
                height: 35px;
            }
            
            .package-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .assistants-grid {
                grid-template-columns: 1fr;
            }
            
            .step-btn {
                padding: 0.8rem 1.5rem;
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader" id="preloader">
        <div style="text-align: center; padding: 2rem; color: white;">
            <h1 style="color: var(--primary-green); margin-bottom: 1rem;">DSOG DELIVERY</h1>
            <p>Loading WhatsApp Delivery Platform...</p>
            <div class="loading-spinner" style="margin-top: 2rem;"></div>
        </div>
    </div>

    <!-- Google Sign-in Modal -->
    <div class="google-signin-modal" id="googleSigninModal">
        <div class="google-signin-content">
            <div style="text-align: center;">
                <h2 style="color: var(--primary-green); margin-bottom: 1rem;">Welcome to DSOG Delivery</h2>
                <p style="margin-bottom: 2rem; color: var(--text-secondary);">
                    Sign in with Google to access the delivery platform
                </p>
                <div id="googleSignInButton"></div>
                <button onclick="skipSignIn()" style="margin-top: 1rem; background: none; border: none; color: var(--text-secondary); cursor: pointer;">
                    Skip for now
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header id="mainHeader">
        <div class="header-content">
            <img src="https://i.postimg.cc/kMZ1jTww/Untitled-design-4-removebg-preview.png" alt="DSOG Delivery" class="logo">
            <button onclick="showSignInModal()" style="background: var(--primary-green); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">
                <i class="fas fa-sign-in-alt"></i> Sign In
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main id="mainContent" style="display: none;">
        <!-- Step Progress -->
        <div class="step-progress" id="stepProgress">
            <div class="step-progress-bar" id="stepProgressBar"></div>
            <div class="step active" data-step="1" onclick="goToStep(1)">
                <div class="step-circle">1</div>
                <div class="step-label">Location</div>
            </div>
            <div class="step" data-step="2" onclick="goToStep(2)">
                <div class="step-circle">2</div>
                <div class="step-label">Package</div>
            </div>
            <div class="step" data-step="3" onclick="goToStep(3)">
                <div class="step-circle">3</div>
                <div class="step-label">Assistant</div>
            </div>
            <div class="step" data-step="4" onclick="goToStep(4)">
                <div class="step-circle">4</div>
                <div class="step-label">Review</div>
            </div>
        </div>

        <!-- Step 1: Location -->
        <div class="step-content active" id="step1">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-map-marker-alt"></i>
                    <h3>Enter Your Location</h3>
                </div>
                <div class="form-group">
                    <input type="text" id="manualLocationInput" class="form-control" 
                           placeholder="Enter your exact pickup location" oninput="validateStep1()">
                </div>
                <button class="step-btn next" onclick="useManualLocation()">
                    <i class="fas fa-check"></i> Set Location
                </button>
                
                <div id="currentLocationDisplay" style="margin-top: 1.5rem; padding: 1rem; background: rgba(37, 211, 102, 0.1); border-radius: 8px; display: none;">
                    <p style="margin: 0; font-weight: 600;">Location set: <span id="currentLocationText"></span></p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-calculator"></i>
                    <h3>Delivery Charge Calculator</h3>
                </div>
                <div class="form-group">
                    <select id="deliveryDistance" class="form-control" required onchange="calculateCharges(); validateStep1()">
                        <option value="">Select distance zone</option>
                        <option value="same">Same Region (0-5km)</option>
                        <option value="nearby">Nearby Region (5-10km)</option>
                        <option value="far">Far Region (10-20km)</option>
                        <option value="distant">Distant Region (20+ km)</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" id="packageWeight" class="form-control" min="0" max="30" step="0.1" 
                           placeholder="Package weight (kg)" oninput="calculateCharges(); validateStep1()">
                </div>
                
                <div id="calculatorResult" style="margin-top: 1.5rem; padding: 1rem; background: rgba(212, 175, 55, 0.1); border-radius: 8px; display: none;">
                    <h4 style="margin-bottom: 1rem; color: var(--primary-gold);">Estimated Charges</h4>
                    <div style="display: grid; gap: 0.5rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Base Charge:</span>
                            <span style="font-weight: 600;" id="baseCharge">Ksh 0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Distance Surcharge:</span>
                            <span style="font-weight: 600;" id="distanceSurcharge">Ksh 0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Weight Surcharge:</span>
                            <span style="font-weight: 600;" id="weightSurcharge">Ksh 0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 0.5rem; margin-top: 0.5rem;">
                            <span style="font-weight: 700;">Total Charge:</span>
                            <span style="font-weight: 700; color: var(--primary-green);" id="totalCharge">Ksh 0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="step-navigation">
                <button class="step-btn prev" disabled>
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="step-btn next" onclick="nextStep()" id="step1NextBtn" disabled>
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Step 2: Package Details -->
        <div class="step-content" id="step2">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-box-open"></i>
                    <h3>Select Package Type</h3>
                </div>
                <div class="package-grid" id="packageTypeSelection">
                    <div class="package-card" data-type="small" data-size="Small (0-5kg)" data-price="200">
                        <i class="fas fa-box" style="font-size: 2.5rem; color: var(--primary-green);"></i>
                        <div style="font-weight: 700;">Small Package</div>
                        <div style="color: var(--text-secondary);">0-5 kg</div>
                        <div style="color: var(--primary-gold); font-weight: 600;">From Ksh 200</div>
                    </div>
                    <div class="package-card" data-type="medium" data-size="Medium (5-15kg)" data-price="290">
                        <i class="fas fa-box-open" style="font-size: 2.5rem; color: var(--primary-green);"></i>
                        <div style="font-weight: 700;">Medium Package</div>
                        <div style="color: var(--text-secondary);">5-15 kg</div>
                        <div style="color: var(--primary-gold); font-weight: 600;">From Ksh 290</div>
                    </div>
                    <div class="package-card" data-type="large" data-size="Large (15-30kg)" data-price="380">
                        <i class="fas fa-pallet" style="font-size: 2.5rem; color: var(--primary-green);"></i>
                        <div style="font-weight: 700;">Large Package</div>
                        <div style="color: var(--text-secondary);">15-30 kg</div>
                        <div style="color: var(--primary-gold); font-weight: 600;">From Ksh 380</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-edit"></i>
                    <h3>Delivery Details</h3>
                </div>
                <div class="form-group">
                    <input type="text" id="customerName" class="form-control" placeholder="Your full name" required oninput="validateStep2()">
                </div>
                <div class="form-group">
                    <input type="tel" id="customerPhone" class="form-control" placeholder="Phone number" required oninput="validateStep2()">
                </div>
                <div class="form-group">
                    <input type="text" id="pickupLocation" class="form-control" placeholder="Pickup address" required oninput="validateStep2()">
                </div>
                <div class="form-group">
                    <input type="text" id="deliveryLocation" class="form-control" placeholder="Delivery address" required oninput="validateStep2()">
                </div>
                <div class="form-group">
                    <textarea id="itemDescription" class="form-control" placeholder="Item description" required oninput="validateStep2()" style="min-height: 100px;"></textarea>
                </div>
            </div>
            
            <div class="step-navigation">
                <button class="step-btn prev" onclick="prevStep()">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="step-btn next" onclick="nextStep()" id="step2NextBtn" disabled>
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Step 3: Assistant Selection -->
        <div class="step-content" id="step3">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-user-tie"></i>
                    <h3>Available Delivery Assistants</h3>
                </div>
                
                <div id="locationWarning" style="display: none; background: rgba(255, 165, 0, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid var(--warning);">
                    <p style="margin: 0; color: var(--text-primary);">
                        <i class="fas fa-exclamation-triangle"></i> 
                        Please set your location in Step 1 to see available assistants in your area.
                    </p>
                </div>
                
                <div class="loading" id="assistantsLoading">
                    <div class="loading-spinner"></div>
                    <p>Loading delivery assistants...</p>
                </div>
                
                <div class="assistants-grid" id="assistantsGrid">
                    <!-- Assistants will be loaded here -->
                </div>
                
                <button class="step-btn next" onclick="loadDeliveryAssistants()" style="margin-top: 1rem;">
                    <i class="fas fa-sync-alt"></i> Refresh Assistants
                </button>
            </div>
            
            <div class="step-navigation">
                <button class="step-btn prev" onclick="prevStep()">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="step-btn next" onclick="nextStep()" id="step3NextBtn" disabled>
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Step 4: Review -->
        <div class="step-content" id="step4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-clipboard-check"></i>
                    <h3>Review Your Order</h3>
                </div>
                <div id="reviewContent">
                    <!-- Review content will be populated here -->
                </div>
                <button class="step-btn confirm" onclick="confirmPickupRequest()" id="finalConfirmBtn" style="margin-top: 2rem;">
                    <i class="fab fa-whatsapp"></i> Confirm & Send via WhatsApp
                </button>
            </div>
            
            <div class="step-navigation">
                <button class="step-btn prev" onclick="prevStep()">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="step-btn next" style="visibility: hidden;">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </main>

    <script>
        // Configuration - ADD YOUR APPSCRIPT URL HERE
        const APPSCRIPT_URL = 'https://script.google.com/macros/s/YOUR_APPSCRIPT_URL/exec'; // Replace with your AppScript URL
        const GOOGLE_CLIENT_ID = '369304497158-8ub6b68v2bjvsfciome6q56flh2rd1m4.apps.googleusercontent.com';
        const SUPPORT_WHATSAPP = '254733737983';
        
        // State management
        let userProfile = JSON.parse(localStorage.getItem('dsog_delivery_profile')) || null;
        let selectedPackageType = null;
        let selectedPackageSize = null;
        let selectedAssistant = null;
        let userLocation = null;
        let deliveryAssistants = [];
        let currentStep = 1;
        
        // Pricing Configuration
        const pricingConfig = {
            baseCharges: {
                small: 200,
                medium: 290,
                large: 380,
                fragile: 250
            },
            distanceMultipliers: {
                same: 0.0,
                nearby: 0.2,
                far: 0.4,
                distant: 0.6
            },
            weightSurcharges: {
                over15kg: 50,
                over20kg: 100
            }
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DSOG Delivery Platform Initializing...');
            
            // Hide preloader after 1.5 seconds
            setTimeout(() => {
                document.getElementById('preloader').classList.add('hidden');
                showSignInModal();
                initPackageSelection();
                initStepNavigation();
            }, 1500);
            
            // Initialize Google Sign-in
            setTimeout(initializeGoogleSignIn, 1000);
        });
        
        // Sign-in Modal Functions
        function showSignInModal() {
            const modal = document.getElementById('googleSigninModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function hideSignInModal() {
            const modal = document.getElementById('googleSigninModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        function skipSignIn() {
            hideSignInModal();
            showMainContent();
        }
        
        // Google Sign-in
        function initializeGoogleSignIn() {
            if (typeof google === 'undefined') {
                console.log('Google SDK not loaded, retrying...');
                setTimeout(initializeGoogleSignIn, 1000);
                return;
            }
            
            try {
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleGoogleSignIn,
                    auto_select: false,
                    context: 'signin'
                });
                
                // Render Google Sign-in button
                google.accounts.id.renderButton(
                    document.getElementById('googleSignInButton'),
                    {
                        type: 'standard',
                        theme: 'filled_blue',
                        size: 'large',
                        text: 'signin_with',
                        shape: 'rectangular'
                    }
                );
                
                console.log('‚úÖ Google Sign-in initialized');
            } catch (error) {
                console.error('Error initializing Google Sign-in:', error);
            }
        }
        
        function handleGoogleSignIn(response) {
            console.log('Google Sign-in response received');
            
            const user = parseJwt(response.credential);
            if (user) {
                userProfile = {
                    googleId: user.sub,
                    email: user.email,
                    name: user.name,
                    picture: user.picture,
                    createdAt: new Date().toISOString()
                };
                
                localStorage.setItem('dsog_delivery_profile', JSON.stringify(userProfile));
                hideSignInModal();
                showMainContent();
                showNotification(`Welcome ${user.name}!`);
                
                // Auto-fill form
                document.getElementById('customerName').value = user.name;
            }
        }
        
        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch {
                return null;
            }
        }
        
        // Show Main Content
        function showMainContent() {
            document.getElementById('mainHeader').style.display = 'block';
            document.getElementById('mainContent').style.display = 'block';
        }
        
        // Step Navigation
        function goToStep(stepNumber) {
            if (stepNumber < 1 || stepNumber > 4) return;
            
            // Validate current step before moving forward
            if (stepNumber > currentStep) {
                if (!validateStep(currentStep)) {
                    showNotification('Please complete all required fields in this step', 'error');
                    return;
                }
            }
            
            currentStep = stepNumber;
            updateStepProgress();
            
            // Hide all steps, show current
            document.querySelectorAll('.step-content').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step' + stepNumber).classList.add('active');
            
            // Load assistants when step 3 is active
            if (stepNumber === 3) {
                if (!userLocation || !userLocation.address) {
                    document.getElementById('locationWarning').style.display = 'block';
                } else {
                    document.getElementById('locationWarning').style.display = 'none';
                    loadDeliveryAssistants();
                }
            }
            
            // Update review when step 4 is active
            if (stepNumber === 4) {
                updateReviewStep();
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function nextStep() {
            if (currentStep < 4) {
                goToStep(currentStep + 1);
            }
        }
        
        function prevStep() {
            if (currentStep > 1) {
                goToStep(currentStep - 1);
            }
        }
        
        function updateStepProgress() {
            const progressPercentage = ((currentStep - 1) / 3) * 100;
            document.getElementById('stepProgressBar').style.width = progressPercentage + '%';
            
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNumber = index + 1;
                step.classList.remove('active', 'completed');
                
                if (stepNumber === currentStep) {
                    step.classList.add('active');
                } else if (stepNumber < currentStep) {
                    step.classList.add('completed');
                }
            });
        }
        
        // Step Validation
        function initStepNavigation() {
            // Auto-validate step 1
            document.getElementById('manualLocationInput').addEventListener('input', validateStep1);
            document.getElementById('deliveryDistance').addEventListener('change', validateStep1);
            document.getElementById('packageWeight').addEventListener('input', validateStep1);
            
            // Auto-validate step 2
            const step2Fields = ['customerName', 'customerPhone', 'pickupLocation', 'deliveryLocation', 'itemDescription'];
            step2Fields.forEach(field => {
                document.getElementById(field).addEventListener('input', validateStep2);
            });
        }
        
        function validateStep(stepNumber) {
            switch(stepNumber) {
                case 1:
                    return validateStep1();
                case 2:
                    return validateStep2();
                case 3:
                    return validateStep3();
                default:
                    return true;
            }
        }
        
        function validateStep1() {
            const hasLocation = document.getElementById('manualLocationInput').value.trim();
            const hasDistance = document.getElementById('deliveryDistance').value;
            const hasWeight = document.getElementById('packageWeight').value && parseFloat(document.getElementById('packageWeight').value) > 0;
            const isValid = hasLocation && hasDistance && hasWeight;
            document.getElementById('step1NextBtn').disabled = !isValid;
            return isValid;
        }
        
        function validateStep2() {
            const hasName = document.getElementById('customerName').value.trim();
            const hasPhone = document.getElementById('customerPhone').value.trim();
            const hasPickup = document.getElementById('pickupLocation').value.trim();
            const hasDelivery = document.getElementById('deliveryLocation').value.trim();
            const hasDescription = document.getElementById('itemDescription').value.trim();
            const isValid = hasName && hasPhone && hasPickup && hasDelivery && hasDescription && selectedPackageType;
            document.getElementById('step2NextBtn').disabled = !isValid;
            return isValid;
        }
        
        function validateStep3() {
            const isValid = !!selectedAssistant;
            document.getElementById('step3NextBtn').disabled = !isValid;
            return isValid;
        }
        
        // Package Selection
        function initPackageSelection() {
            document.querySelectorAll('.package-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.package-card').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedPackageType = this.dataset.type;
                    selectedPackageSize = this.dataset.size;
                    validateStep2();
                    
                    // Recalculate charges if distance and weight are set
                    const distance = document.getElementById('deliveryDistance').value;
                    const weight = document.getElementById('packageWeight').value;
                    if (distance && weight) {
                        calculateCharges();
                    }
                });
            });
        }
        
        // Location Functions
        function useManualLocation() {
            const location = document.getElementById('manualLocationInput').value.trim();
            if (!location) {
                showNotification('Please enter a location', 'error');
                return;
            }
            
            userLocation = { 
                manual: true, 
                address: location,
                zone: 'Central' // Simplified for demo
            };
            
            document.getElementById('pickupLocation').value = location;
            document.getElementById('currentLocationText').textContent = location;
            document.getElementById('currentLocationDisplay').style.display = 'block';
            
            validateStep1();
            showNotification('Location set successfully!');
        }
        
        // Charge Calculation
        function calculateCharges() {
            const packageType = selectedPackageType || 'small';
            const distanceZone = document.getElementById('deliveryDistance').value;
            const weight = parseFloat(document.getElementById('packageWeight').value) || 0;
            
            if (!distanceZone) {
                document.getElementById('calculatorResult').style.display = 'none';
                return;
            }
            
            let baseCharge = pricingConfig.baseCharges[packageType] || 200;
            const distanceMultiplier = pricingConfig.distanceMultipliers[distanceZone] || 0;
            const distanceSurcharge = Math.round(baseCharge * distanceMultiplier);
            
            let weightSurcharge = 0;
            if (weight > 20) {
                weightSurcharge = pricingConfig.weightSurcharges.over20kg;
            } else if (weight > 15) {
                weightSurcharge = pricingConfig.weightSurcharges.over15kg;
            }
            
            const totalCharge = baseCharge + distanceSurcharge + weightSurcharge;
            
            document.getElementById('baseCharge').textContent = `Ksh ${baseCharge}`;
            document.getElementById('distanceSurcharge').textContent = `Ksh ${distanceSurcharge}`;
            document.getElementById('weightSurcharge').textContent = `Ksh ${weightSurcharge}`;
            document.getElementById('totalCharge').textContent = `Ksh ${totalCharge}`;
            document.getElementById('calculatorResult').style.display = 'block';
            
            // Store charges for review step
            window.currentCharges = {
                baseCharge,
                distanceSurcharge,
                weightSurcharge,
                totalCharge
            };
        }
        
        // Load Delivery Assistants from AppScript
        async function loadDeliveryAssistants() {
            const loadingElement = document.getElementById('assistantsLoading');
            const gridElement = document.getElementById('assistantsGrid');
            
            loadingElement.classList.add('visible');
            gridElement.innerHTML = '';
            
            try {
                console.log('üì° Loading delivery assistants from AppScript...');
                
                // Replace with your AppScript URL
                const response = await fetch(`${APPSCRIPT_URL}?action=getDeliveryAssistants&timestamp=${Date.now()}`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                let assistants = [];
                
                if (response.ok) {
                    const result = await response.json();
                    
                    if (result && result.success && Array.isArray(result.data)) {
                        assistants = result.data.map(assistant => ({
                            id: assistant.id || assistant.assistant_id || `DA-${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                            name: assistant.name || assistant.assistant_name || 'Unknown Assistant',
                            phone: assistant.phone || assistant.phone_number || '+254700000000',
                            vehicle: assistant.vehicle || assistant.vehicle_type || 'Vehicle not specified',
                            status: assistant.status || 'available',
                            rating: parseFloat(assistant.rating || 4.5),
                            completedDeliveries: parseInt(assistant.completedDeliveries || assistant.completed_deliveries || 0),
                            location: assistant.location || assistant.area || 'Location not specified',
                            area: assistant.area || assistant.zone || 'Central',
                            isActive: assistant.isActive !== false && assistant.active !== false
                        }));
                        console.log(`‚úÖ Loaded ${assistants.length} assistants from AppScript`);
                    } else {
                        console.log('Using fallback data structure');
                        assistants = getFallbackAssistants();
                    }
                } else {
                    console.log('Network response not ok, using fallback data');
                    assistants = getFallbackAssistants();
                }
                
                // Filter by location if set
                if (userLocation && userLocation.zone) {
                    assistants = assistants.filter(assistant => 
                        assistant.isActive && 
                        (assistant.area === userLocation.zone || 
                         assistant.location.toLowerCase().includes(userLocation.zone.toLowerCase()))
                    );
                } else {
                    assistants = assistants.filter(assistant => assistant.isActive);
                }
                
                deliveryAssistants = assistants;
                displayAssistants(assistants);
                
            } catch (error) {
                console.error('‚ùå Error loading assistants:', error);
                console.log('Using fallback assistant data');
                const assistants = getFallbackAssistants();
                deliveryAssistants = assistants;
                displayAssistants(assistants);
            } finally {
                loadingElement.classList.remove('visible');
            }
        }
        
        function getFallbackAssistants() {
            return [
                {
                    id: 'DA001',
                    name: 'John Kamau',
                    phone: '+254712345678',
                    vehicle: 'Toyota Probox - KDA 123A',
                    status: 'available',
                    rating: 4.8,
                    completedDeliveries: 120,
                    location: 'Nairobi CBD',
                    area: 'Central',
                    isActive: true
                },
                {
                    id: 'DA002',
                    name: 'Susan Wanjiku',
                    phone: '+254723456789',
                    vehicle: 'Suzuki Every - KCB 456B',
                    status: 'available',
                    rating: 4.9,
                    completedDeliveries: 95,
                    location: 'Westlands',
                    area: 'West',
                    isActive: true
                },
                {
                    id: 'DA003',
                    name: 'Peter Odhiambo',
                    phone: '+254734567890',
                    vehicle: 'Nissan NV350 - KDC 789C',
                    status: 'available',
                    rating: 4.7,
                    completedDeliveries: 150,
                    location: 'Industrial Area',
                    area: 'South',
                    isActive: true
                }
            ];
        }
        
        function displayAssistants(assistants) {
            const gridElement = document.getElementById('assistantsGrid');
            
            if (assistants.length === 0) {
                gridElement.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        <i class="fas fa-users-slash" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h4>No Assistants Available</h4>
                        <p>There are currently no delivery assistants available in your area.</p>
                    </div>
                `;
                return;
            }
            
            gridElement.innerHTML = assistants.map(assistant => `
                <div class="assistant-card" onclick="selectAssistant('${assistant.id}')" data-assistant-id="${assistant.id}">
                    <div style="background: linear-gradient(135deg, var(--primary-black), #1a1a1a); color: white; padding: 1.5rem; position: relative;">
                        <div style="position: absolute; top: 1rem; right: 1rem; background: ${assistant.status === 'available' ? 'var(--primary-green)' : 'var(--warning)'}; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">
                            ${assistant.status}
                        </div>
                        <h3 style="margin: 0 0 0.5rem 0;">${assistant.name}</h3>
                        <div style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 0.5rem;">ID: ${assistant.id}</div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.95rem;">
                            <i class="fas fa-car"></i>
                            <span>${assistant.vehicle}</span>
                        </div>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: 600; color: var(--text-secondary);">Phone:</span>
                                <span>${assistant.phone}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: 600; color: var(--text-secondary);">Location:</span>
                                <span>${assistant.location}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: 600; color: var(--text-secondary);">Rating:</span>
                                <div style="color: var(--primary-gold);">
                                    <i class="fas fa-star"></i> ${assistant.rating} (${assistant.completedDeliveries} deliveries)
                                </div>
                            </div>
                        </div>
                        <button style="width: 100%; background: var(--primary-green); color: white; border: none; padding: 0.8rem; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i class="fas fa-truck-loading"></i>
                            Select Assistant
                        </button>
                        <button onclick="window.open('https://wa.me/${assistant.phone.replace(/\D/g, '')}', '_blank')" style="width: 100%; background: #25D366; color: white; border: none; padding: 0.8rem; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-top: 0.5rem;">
                            <i class="fab fa-whatsapp"></i>
                            Message on WhatsApp
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function selectAssistant(assistantId) {
            const assistant = deliveryAssistants.find(a => a.id === assistantId);
            if (!assistant) return;
            
            selectedAssistant = assistant;
            
            // Remove selected class from all assistant cards
            document.querySelectorAll('.assistant-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selected class to clicked assistant card
            const selectedCard = document.querySelector(`[data-assistant-id="${assistantId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
            
            validateStep3();
            showNotification(`Selected assistant: ${assistant.name}`);
        }
        
        // Review Step
        function updateReviewStep() {
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const pickupLocation = document.getElementById('pickupLocation').value;
            const deliveryLocation = document.getElementById('deliveryLocation').value;
            const itemDescription = document.getElementById('itemDescription').value;
            
            const reviewContent = document.getElementById('reviewContent');
            reviewContent.innerHTML = `
                <div style="display: grid; gap: 1.5rem;">
                    <div>
                        <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">Pickup Location:</div>
                        <div style="font-weight: 500;">${pickupLocation}</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">Delivery Destination:</div>
                        <div style="font-weight: 500;">${deliveryLocation}</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">Package Type:</div>
                        <div style="font-weight: 500;">${selectedPackageType ? selectedPackageType.charAt(0).toUpperCase() + selectedPackageType.slice(1) + ' - ' + selectedPackageSize : 'Not selected'}</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">Selected Assistant:</div>
                        <div style="font-weight: 500;">${selectedAssistant ? selectedAssistant.name + ' (' + selectedAssistant.phone + ')' : 'Not selected'}</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">Customer Details:</div>
                        <div style="font-weight: 500;">${customerName} | ${customerPhone}</div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">Items:</div>
                        <div style="font-weight: 500;">${itemDescription}</div>
                    </div>
                    ${window.currentCharges ? `
                    <div style="background: rgba(212, 175, 55, 0.1); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary-gold);">
                        <h4 style="color: var(--primary-gold); margin-bottom: 1rem;">
                            <i class="fas fa-money-bill-wave"></i> Delivery Charges
                        </h4>
                        <div style="display: grid; gap: 0.8rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Base Charge:</span>
                                <span style="font-weight: 600;">Ksh ${window.currentCharges.baseCharge}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Distance Surcharge:</span>
                                <span style="font-weight: 600;">Ksh ${window.currentCharges.distanceSurcharge}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Weight Surcharge:</span>
                                <span style="font-weight: 600;">Ksh ${window.currentCharges.weightSurcharge}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; border-top: 1px solid rgba(0,0,0,0.1); padding-top: 0.8rem; margin-top: 0.5rem;">
                                <span style="font-weight: 700; font-size: 1.1rem;">Total Charge:</span>
                                <span style="font-weight: 700; color: var(--primary-green); font-size: 1.1rem;">Ksh ${window.currentCharges.totalCharge}</span>
                            </div>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('finalConfirmBtn').disabled = !validateStep2() || !validateStep3();
        }
        
        // Confirm Pickup Request
        function confirmPickupRequest() {
            if (!validateStep1() || !validateStep2() || !validateStep3()) {
                showNotification('Please complete all steps before confirming', 'error');
                return;
            }
            
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const pickupLocation = document.getElementById('pickupLocation').value;
            const deliveryLocation = document.getElementById('deliveryLocation').value;
            const itemDescription = document.getElementById('itemDescription').value;
            const distanceZone = document.getElementById('deliveryDistance').value;
            const weight = document.getElementById('packageWeight').value;
            
            // Generate tracking number
            const trackingNumber = 'DSOG-' + Date.now().toString().slice(-6);
            
            // Build WhatsApp message
            const message = `*üì¶ NEW PICKUP REQUEST - DSOG DELIVERY*%0A%0A` +
                           `*Tracking:* ${trackingNumber}%0A` +
                           `*Date:* ${new Date().toLocaleDateString()}%0A` +
                           `*Time:* ${new Date().toLocaleTimeString()}%0A%0A` +
                           `*üë§ CUSTOMER DETAILS*%0A` +
                           `Name: ${customerName}%0A` +
                           `Phone: ${customerPhone}%0A%0A` +
                           `*üìç PICKUP LOCATION*%0A` +
                           `${pickupLocation}%0A%0A` +
                           `*üéØ DELIVERY DESTINATION*%0A` +
                           `${deliveryLocation}%0A%0A` +
                           `*üì¶ PACKAGE DETAILS*%0A` +
                           `Type: ${selectedPackageType.charAt(0).toUpperCase() + selectedPackageType.slice(1)}%0A` +
                           `Size: ${selectedPackageSize}%0A` +
                           `Weight: ${weight}kg%0A` +
                           `Items: ${itemDescription}%0A%0A` +
                           `*üí∞ DELIVERY CHARGES*%0A` +
                           `Total: Ksh ${window.currentCharges ? window.currentCharges.totalCharge : '0'}%0A%0A` +
                           `*üë∑ SELECTED ASSISTANT*%0A` +
                           `${selectedAssistant.name}%0A` +
                           `${selectedAssistant.phone}%0A%0A` +
                           `_Please confirm pickup time and provide ETA_%0A` +
                           `_Customer will track delivery via WhatsApp_`;
            
            // Open WhatsApp with the selected assistant
            const assistantPhone = selectedAssistant.phone.replace(/\D/g, '');
            const whatsappUrl = `https://wa.me/${assistantPhone}?text=${message}`;
            window.open(whatsappUrl, '_blank');
            
            // Also send to support for backup
            const supportMessage = `*BACKUP: PICKUP REQUEST - ${selectedAssistant.name}*%0A%0A${message}`;
            const supportWhatsappUrl = `https://wa.me/${SUPPORT_WHATSAPP}?text=${supportMessage}`;
            window.open(supportWhatsappUrl, '_blank');
            
            // Save to local history
            saveToDeliveryHistory(
                trackingNumber,
                customerName,
                customerPhone,
                pickupLocation,
                deliveryLocation,
                selectedPackageType,
                selectedPackageSize,
                itemDescription,
                selectedAssistant.name,
                selectedAssistant.phone,
                window.currentCharges
            );
            
            // Reset form and go back to step 1
            resetRequestForm();
            goToStep(1);
            
            showNotification(`Pickup request sent to ${selectedAssistant.name}! Save their number for tracking.`);
        }
        
        function saveToDeliveryHistory(trackingNumber, customerName, customerPhone, pickupLocation, deliveryLocation, packageType, packageSize, itemDescription, assistantName, assistantPhone, charges) {
            const deliveryRecord = {
                trackingNumber,
                customerName,
                customerPhone,
                pickupLocation,
                deliveryLocation,
                packageType,
                packageSize,
                itemDescription,
                assistantName,
                assistantPhone,
                charges,
                status: 'pending',
                requestDate: new Date().toISOString(),
                googleUserId: userProfile ? userProfile.googleId : 'guest'
            };
            
            // Add to local history
            let history = JSON.parse(localStorage.getItem('dsog_delivery_history')) || [];
            history.unshift(deliveryRecord);
            localStorage.setItem('dsog_delivery_history', JSON.stringify(history));
            
            console.log('‚úÖ Delivery request saved to local history');
        }
        
        function resetRequestForm() {
            // Reset form fields
            ['manualLocationInput', 'deliveryDistance', 'packageWeight', 
             'customerName', 'customerPhone', 'pickupLocation', 
             'deliveryLocation', 'itemDescription'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            // Reset selections
            document.querySelectorAll('.package-card, .assistant-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Hide location display and calculator result
            document.getElementById('currentLocationDisplay').style.display = 'none';
            document.getElementById('calculatorResult').style.display = 'none';
            
            // Reset state
            selectedPackageType = null;
            selectedPackageSize = null;
            selectedAssistant = null;
            userLocation = null;
            window.currentCharges = null;
        }
        
        // Notification system
        function showNotification(message, type = 'success') {
            // Remove any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            const notification = document.createElement('div');
            notification.className = 'notification show';
            
            if (type === 'error') {
                notification.style.background = 'var(--error)';
            } else if (type === 'warning') {
                notification.style.background = 'var(--warning)';
                notification.style.color = 'var(--primary-black)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }
    </script>
</body>
</html>
